FROM node:22-alpine AS builder
ENV NEXT_PUBLIC_BACKEND_URL="https://develop-chaqchao-api.acide.araozu.dev/api/v1"
ENV NEXT_WEBSOCKET_PORT=5000
ENV NEXT_PUBLIC_BACKEND_URL_GOOGLE_LOGIN="auth/client/google/login"
ENV NEXT_PUBLIC_PAYPAL_CLIENT_ID="AROj0pavjSqzvCYlifTY0WwNaB2PAw-s4LSZqftWEEdnSX18OrdFye0w3Qy-fbf-C5oRrgJTLYD07M3k"

ENV TZ=America/Lima
RUN apk add --no-cache tzdata && \
    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && \
    echo $TZ > /etc/timezone



ARG NEXT_PUBLIC_BACKEND_URL="/"
ENV NEXT_PUBLIC_BACKEND_URL=${NEXT_PUBLIC_BACKEND_URL}

ARG NEXT_PUBLIC_SOCKET_URL="/"
ENV NEXT_PUBLIC_SOCKET_URL=${NEXT_PUBLIC_SOCKET_URL}

ARG NEXT_PUBLIC_BACKEND_URL_GOOGLE_LOGIN="/"
ENV NEXT_PUBLIC_BACKEND_URL_GOOGLE_LOGIN=${NEXT_PUBLIC_BACKEND_URL_GOOGLE_LOGIN}

ARG NEXT_PUBLIC_API_SUNAT_TOKEN="/"
ENV NEXT_PUBLIC_API_SUNAT_TOKEN=${NEXT_PUBLIC_API_SUNAT_TOKEN}

ARG NEXT_PUBLIC_LINK_API_SUNAT="/"
ENV NEXT_PUBLIC_LINK_API_SUNAT=${NEXT_PUBLIC_LINK_API_SUNAT}

ARG NEXT_PUBLIC_PAYPAL_CLIENT_ID="/"
ENV NEXT_PUBLIC_PAYPAL_CLIENT_ID=${NEXT_PUBLIC_PAYPAL_CLIENT_ID}

ARG NEXT_PUBLIC_IZIPAY_PAYMENT_USERNAME="/"
ENV NEXT_PUBLIC_IZIPAY_PAYMENT_USERNAME=${NEXT_PUBLIC_IZIPAY_PAYMENT_USERNAME}

ARG NEXT_PUBLIC_IZIPAY_PAYMENT_PASSWORD="/"
ENV NEXT_PUBLIC_IZIPAY_PAYMENT_PASSWORD=${NEXT_PUBLIC_IZIPAY_PAYMENT_PASSWORD}

ARG NEXT_PUBLIC_IZIPAY_PAYMENT_ENDPOINT="/"
ENV NEXT_PUBLIC_IZIPAY_PAYMENT_ENDPOINT=${NEXT_PUBLIC_IZIPAY_PAYMENT_ENDPOINT}

ARG NEXT_PUBLIC_IZIPAY_PAYMENT_PUBLIC_KEY="/"
ENV NEXT_PUBLIC_IZIPAY_PAYMENT_PUBLIC_KEY=${NEXT_PUBLIC_IZIPAY_PAYMENT_PUBLIC_KEY}

ARG NEXT_PUBLIC_WEB_CHAQCHAO="/"
ENV NEXT_PUBLIC_WEB_CHAQCHAO=${NEXT_PUBLIC_WEB_CHAQCHAO}


WORKDIR /app
COPY package.json ./
COPY package-lock.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:22-alpine

WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/next.config.mjs ./next.config.mjs

CMD ["npm", "run", "start"]
